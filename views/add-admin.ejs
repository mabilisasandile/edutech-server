<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Signup Page</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='mvp.css'>
</head>

<body>
    <main>
        <section>
            <form>
                <label>Login</label>
                <input type="text" name="login" />
                <label>Password</label>
                <input type="password" name="password" />
                <button>Register</button>
            </form>
        </section>
        <script>
            const firebaseConfig = {
                apiKey: "AIzaSyCI6TYQ3ZYawor7WxjhTwKnDQKT8_Sj6gI",
                authDomain: "edutech-app-eecfd.firebaseapp.com",
                projectId: "edutech-app-eecfd",
                storageBucket: "edutech-app-eecfd.appspot.com",
                messagingSenderId: "904449562777",
                appId: "1:904449562777:web:27e8ad9dd1a27d5054c008",
                measurementId: "G-7CCCTV9REH"
            };
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);

            //Write the code which will register the user
            firebase.auth().setPersistence(firebase.auth.Auth.Persistence.None)

            document.getElementById('signup')
            .addEventListener('click',function(e){
                e.preventDefault()

                const login = event.target.login.value
                const password = event.target.password.value

                firebase.auth().createUserWithEmailAndPassword(login,password)
                .then(({user}) => {
                    return user.getIdToken().then((idToken) => {
                        return fetch("/sessionLogin", {
                            method:'POST',
                            headers:{
                                Accept:'application/json',
                                "Content-Type":"application/json",
                                "CSRF-Token":Cookies.get("XSRF-TOKEN")
                            },
                            body:JSON.stringify({idToken})
                        })
                    })
                })
                .then(() => {
                   return firebase.auth().signOut()
                })
                .then(() => {
                    window.location.assign("/profile")
                })
            })

        </script>
    </main>

</body>

</html>